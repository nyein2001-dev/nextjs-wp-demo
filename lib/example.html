 Change Beneficiary 
Change Method of Payment to Auto-Debit-Arrangement (ADA) or Direct debit
Change Method of Payment to Credit Card or Credit Card enrollment 
Change Payment Frequency 
Dividend Withdrawal for Traditional Policies
Feedback
Follow-up Request (New)
Full Withdrawal or Cash Surrender 
Fund Switch or Premium Redirection 
Inclusion of Rider or Deletion of Rider 
Increase Sum Assured or Increase in Premium
Other questions
Partial Withdrawal
Pay Premium
Refund Request
Reinstatement
Submission of pending requirements (New)
Top-up
Change of Agent or Transfer of Business (New)
Update Mobile number or Email address 
Update Residential or Correspondence Address

Let us know what you're looking for in your new agent
Dropdown requirements:
Default display text: Gender

Dropdown options:
Female
Male
No preference

Do you prefer your new agent to be based close to your registered address?

Service Number * (example: PLUK1234567890)

<input 
  type="text" 
  pattern="^PLUK[0-9]{8,10}$" 
  title="Must start with PLUK followed by 8 to 10 digits" 
  required
/>


Please enter a valid Service Number

Your service number is included in the auto-generated email you receive after submitting your initial request. Alternatively, it may be provided directly by one of our customer support team members.

The service number format is case-sensitive and must begin with "PLUK" followed by numeric characters (e.g., PLUK1234567890).

----------------------------------------------------
Service Number * (example: PLUK1234567890)

Your service number is included in the auto-generated email you receive after submitting your initial request. Alternatively, it may be provided directly by one of our customer support team members.

The service number format is case-sensitive and must begin with "PLUK" followed by numeric characters (e.g., PLUK1234567890).

Attach the pending requirement/s here:

Note: The maximum file size for each document is 5 MB. Acceptable doc type to be uploaded: png, jpeg, pdf, doc, docx, heic, jpg.

Document 1*


----------------------------------------------------------
Added Radio button options:
Refund of excess renewal premium payment – for after sales refund request
Refund of application payment – for new business refund request


Updated text for upload fields
Signed refund request letter *
Clear copy of government issued IDs reflecting signature*
Proof of Bank Account (for fund transfer disbursement)

Details of your concern:

Message

<div id="refund_request" style="display: block;">
    <div style="display: flex; gap: 30px; align-items: flex-start; flex-wrap: wrap;">
        
        <!-- First radio -->
        <label for="refund_of_excess_renewal_premium_payment" 
               style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 4px;">
            <input type="radio" 
                   style="width: 18px; height: 18px; cursor: pointer; margin: 0; flex-shrink: 0;"
                   name="refund_request" 
                   id="refund_of_excess_renewal_premium_payment" 
                   value="Refund of excess renewal premium payment">
            <span style="font-size: 14px; line-height: 1.3;">Refund Of Excess Renewal Premium Payment</span>
        </label>
        
        <!-- Second radio -->
        <label for="refund_of_application_payment" 
               style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; border-radius: 4px;">
            <input type="radio" 
                   style="width: 18px; height: 18px; cursor: pointer; margin: 0; flex-shrink: 0;"
                   name="refund_request" 
                   id="refund_of_application_payment" 
                   value="Refund of application payment">
            <span style="font-size: 14px; line-height: 1.3;">Refund Of Application Payment</span>
        </label>
        
    </div>
</div>


---------------------------------
New Servicing Agent Information *

Please obtain these details directly from your newly selected agent.

New servicing agent’s complete name *
New servicing agent’s code *
New servicing agent’s branch name *

Acknowledgement of Policyowner: * (Pick at least 1)
I, as the Policyowner, would like to request to be transferred to the new Pru Life UK servicing agent as stated above due to the following reason/s:

I want to consolidate all my policies with one servicing agent.
It is convenient for me to make transactions, I find it easy to contact the new agent, and I am comfortable discussing my policy needs. 
Others (Please specify)

Additional requirements may be requested after your submission is reviewed.
Attachment:
Note: The maximum file size for each document is 5 MB. Acceptable doc type to be uploaded: png, jpeg, pdf, doc, docx, heic, jpg.
Clear copy of valid ID/s *

--------
To request for Change of Agent or Transfer of Business, kindly attach the following:
Duly accomplished Change of Servicing Agent form with the following signature requirements:
Additional requirements may be requested after your submission is reviewed.
Attachment:
Note: The maximum file size for each document is 5 MB. Acceptable doc type to be uploaded: png, jpeg, pdf, doc, docx, heic, jpg.
Change of Servicing Agent Form*

Links:
Change of Servicing Agent form - https://www.prulifeuk.com.ph/export/sites/prudential-ph/en/.galleries/pdf/change-of-servicing-agent-form.pdf 


Dropdown requirements:
Default display text: Do you have an existing agent?

Dropdown options:
No active agent
With existing agent

Do you have a preferred agent? 




When testing with the following referral link generated by CEP:  https://10.193.16.22:449/vi/referee-form-test/index.html?uniqueId=be8ab868-9e7b-5fd9-b99a-0599a5644541&agentCode=4dc00ca4-21fd-5e96-92c9-14a176ae16a4&leadSource=cep_ob1 or

https://10.193.16.22:449/vi/referee-form-test/?uniqueId=be8ab868-9e7b-5fd9-b99a-0599a5644541&agentCode=4dc00ca4-21fd-5e96-92c9-14a176ae16a4&leadSource=cep_nps

submissionID and leadSource 

const uniqueId = params.get('uniqueId') || params.get('submissionID');

// Replace your existing try-catch block with this enhanced version

try {
    os = con.getOutputStream();
    os.write(bout);
    
    content = new StringBuffer();
    
    // Check response code first
    int responseCode = con.getResponseCode();
    
    if (responseCode == 200) {
        // Success - read from input stream
        in = new BufferedReader(new InputStreamReader(con.getInputStream()));
        inputLine = "";
        
        while ((inputLine = in.readLine()) != null) {
            content.append(inputLine);
        }
        in.close();
        apiResponse = content.toString();
        saveReferreeResponse = content.toString();
        con.disconnect();
        
        isApiCallSuccess = true;
    } else {
        // Error - read from error stream to get detailed error message
        InputStream errorStream = con.getErrorStream();
        if (errorStream != null) {
            BufferedReader errorReader = new BufferedReader(new InputStreamReader(errorStream));
            StringBuilder errorContent = new StringBuilder();
            String errorLine;
            
            while ((errorLine = errorReader.readLine()) != null) {
                errorContent.append(errorLine);
            }
            errorReader.close();
            
            // Parse the error JSON to extract user-friendly message
            String errorResponse = errorContent.toString();
            String userFriendlyMessage = parseErrorMessage(errorResponse);
            
            out.print(responseObject(400, "API Request Failed: " + userFriendlyMessage));
        } else {
            out.print(responseObject(400, "API Request Failed with status code: " + responseCode));
        }
        
        isApiCallSuccess = false;
        con.disconnect();
        return; // Exit early on error
    }
    
} catch (Exception ex) {
    out.print(responseObject(400, "Connection Error: Unable to connect to the API service"));
    isApiCallSuccess = false;
}

// Add this helper method to parse the error JSON and extract user-friendly message
private String parseErrorMessage(String errorJson) {
    try {
        // Simple JSON parsing - you can use a JSON library like Jackson or Gson for better parsing
        if (errorJson.contains("errorDescription")) {
            // Extract error description from JSON
            String[] parts = errorJson.split("\"errorDescription\":");
            if (parts.length > 1) {
                String desc = parts[1].split(",")[0].replace("\"", "").trim();
                return desc;
            }
        }
        
        // If no specific error description found, return the full error
        return errorJson;
        
    } catch (Exception e) {
        return "Error processing request";
    }
}

{
    "fullName": "viet Test",
    "mobile": "0346786789",
    "messageDetails": "remark string",
   // "referralId": "be8ab868-9e7b-5fd9-b99a-0599a5644541",
    "clientId": "ed10432e-8afb-48a0-8262-88d7e17a6b70",
    "leadSource": "cep_ob1",
    "location": "HCM",
    "referralAgent": "600000012",
    "email": "test@gmail.com"
}

080300002551

if (r(e.currentTarget).attr("name") === "policyRadios") {
        return; // Exit early, don't show popup
    }


Policy number:
Email address:
Transaction:
Preferred agent’s gender:
Located near client’s address:

 const selected = document.querySelector('input[name="fruit"]:checked');


Change of Agent or Transfer of Business No preferred agent

Change of Agent or Transfer of Business With existing agent

Change of Agent or Transfer of Business No active agent 

New servicing agent’s complete name: <Agent name entered>
New servicing agent’s code: <Agent’s code entered>
New servicing agent’s branch name: <Agent’s branch entered>


 “Details of your concern” exceeds the 2,000-character limit

/^([\s\S]{1,2000})$/

 var othersValue = othersText.value.trim();
outputText += "Others: " + othersValue;





