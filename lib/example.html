fitri.afiq@gravitas.my<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PruBSN Takaful Enquiry Form</title>
</head>
<body>

    <!-- Main form container -->
    <div>
        <h1>PruBSN Takaful Enquiry</h1>
        
        <!-- The form itself -->
        <form action="https://test.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8&orgId=00DWJ000005CytZ" method="POST">

            <!-- Hidden Salesforce fields -->
            <input type="hidden" name="oid" value="00DWJ000005CytZ">
            <input type="hidden" name="retURL" value="https://www.prubsn.com.my/">
			
			<select  id="lead_source" name="lead_source" style="display:none;">
				<option value="">--None--</option>
				<option value="Website" selected>Website</option>
			</select><br>
			
			<input type="hidden" name="debug" value=1>
			<input type="hidden" name="debugEmail"value="nyein.chan@gravitas.my">
			
			<!-- Hidden fields for UTM & Campaign tracking -->
			<input type="hidden" id="00NWJ000005RA5F" name="00NWJ000005RA5F" maxlength="255" size="20" /> <!-- utm_source -->
			<input type="hidden" id="00NWJ000005RAOb" name="00NWJ000005RAOb" maxlength="255" size="20" /> <!-- utm_medium -->
			<input type="hidden" id="00NWJ000005RARp" name="00NWJ000005RARp" maxlength="255" size="20" /> <!-- campaign -->
			<input type="hidden" id="00NWJ000005RAtF" name="00NWJ000005RAtF" maxlength="255" size="20" /> <!-- utm_term -->
			<input type="hidden" id="00NWJ000005RBHR" name="00NWJ000005RBHR" maxlength="255" size="20" /> <!-- utm_content -->

			<select id="Campaign_ID" name="Campaign_ID" style="display:none;">
			  <option value="">--None--</option>
			  <option value="701WJ00000Lo5el">MgM Campaign Sep'25</option>
			</select>
			
            <!-- Existing Customer Question (radio buttons) -->
            <div>
                <label>Are you an existing PruBSN Takaful customer?</label>
                <div>
                    <div>
                        <input type="radio" id="isCustomerYes" name="isCustomer" value="Y" required>
                        <label for="isCustomerYes">Y</label>
                    </div>
                    <div>
                        <input type="radio" id="isCustomerNo" name="isCustomer" value="N" required>
                        <label for="isCustomerNo">N</label>
                    </div>
                </div>
            </div>

            <!-- Full Name field -->
            <div>
                <label for="last_name">Full Name:</label>
                <input id="last_name" maxlength="80" name="last_name" type="text" placeholder="John Doe" required>
            </div>

            <!-- Phone Number field (Malaysian only) -->
            <div>
                <label for="phone">Phone Number (Malaysia):</label>
                <input id="phone" maxlength="40" name="phone" type="tel" placeholder="e.g. 0123456789" required>
            </div>

            <!-- Email Address field -->
            <div>
                <label for="email">Email Address:</label>
                <input id="email" maxlength="80" name="email" type="email" placeholder="johndoe@example.com" required>
            </div>

            <!-- IC Number field with placeholder -->
            <div>
                <label for="icNumber">IC Number:</label>
                <input id="icNumber" maxlength="12" name="00NWJ000005H5tF" type="text" placeholder="e.g. 990909109191 (no hyphens)" required>
            </div>
			
			<!-- STATE PICKLIST (Salesforce field 00NWJ000005V1JV) -->
			<div id="locationField">
				<label for="00NWJ000005V1JV">State:</label>
				<select id="00NWJ000005V1JV" name="00NWJ000005V1JV" title="State" required onchange="loadCities()">
					<option value="" disabled selected>Please select a state</option>
					<option value="KL & Selangor">KL & Selangor</option>
					<option value="Perak">Perak</option>
					<option value="Penang">Penang</option>
					<option value="Melaka">Melaka</option>
					<option value="Negeri Sembilan">Negeri Sembilan</option>
					<option value="Johor">Johor</option>
					<option value="Kedah">Kedah</option>
					<option value="Perlis">Perlis</option>
					<option value="Pahang">Pahang</option>
					<option value="Kelantan">Kelantan</option>
					<option value="Terengganu">Terengganu</option>
					<option value="Sabah">Sabah</option>
					<option value="Sarawak">Sarawak</option>
				</select>
			</div>
			
			<!-- CITY PICKLIST (Salesforce field 00NWJ000005H5oP) -->
			<div id="locationField">
				<label for="location">City:</label>
				<select id="location" name="00NWJ000005H5oP" title="City" required>
					<option value="" disabled selected>Please select a city</option>
				</select>
			</div>

            <!-- Conditional field 7: Type of Enquiry (shown if 'Y' is selected) -->
            <div id="enquiryField" style="display: none;">
                <label for="00NWJ000005H5q1">What is your type of enquiry?</label>
                <select id="enquiry" name="00NWJ000005H5q1" title="Type of Enquiry" required>
                    <option value="" disabled selected>Please select an enquiry type</option>
                    <option value="New plan / certificate related">New plan / certificate related</option>
                    <option value="Claims related / others">Claims related / others</option>
                </select>
            </div>

            <!-- Consent Checkbox -->
            <div>
                <input type="checkbox" id="consent" name="00NWJ000005H5rd" value="1" required>
                <label for="consent">
                    I agree to the terms and conditions and consent to my data being processed.
                </label>
            </div>

            <!-- Submit button -->
            <input type="submit" name="submit">

        </form>
    </div>

    <script>
        // Get the radio buttons for existing customer
        const isCustomerYes = document.getElementById('isCustomerYes');
        const isCustomerNo = document.getElementById('isCustomerNo');
        
        // Get the conditional fields' containers
        //const locationField = document.getElementById('locationField');
        const enquiryField = document.getElementById('enquiryField');

        // Function to update the visibility of the conditional fields
        function updateConditionalFields() {
            if (isCustomerYes.checked) {
                // If the user is an existing customer ('Y'), show the enquiry field and hide the location field
                enquiryField.style.display = 'block';
                //locationField.style.display = 'none';
                document.getElementById('enquiry').required = true;
                document.getElementById('location').required = false;
            } else if (isCustomerNo.checked) {
                // If the user is not an existing customer ('N'), show the location field and hide the enquiry field
                //locationField.style.display = 'block';
                enquiryField.style.display = 'none';
                document.getElementById('location').required = true;
                document.getElementById('enquiry').required = false;
            } else {
                // Hide both if neither is selected initially
                //locationField.style.display = 'none';
                enquiryField.style.display = 'none';
            }
        }

        // Add event listeners to the radio buttons to call the function when they are changed
        isCustomerYes.addEventListener('change', updateConditionalFields);
        isCustomerNo.addEventListener('change', updateConditionalFields);

        // Call the function on page load to set the initial state
        updateConditionalFields();
        
        // Add a simple form submission listener for demonstration
        document.getElementById('leadForm').addEventListener('submit', function(event) {
            // This alert is here for demonstration purposes. In a real-world scenario, you would
            // remove this and allow the form to submit to Salesforce.
            alert('Form submitted successfully!');
        });
    </script>
	
	<script>
	  function getQueryParam(name) {
		let params = new URLSearchParams(window.location.search);
		return params.get(name) || "";
	  }

	  document.addEventListener("DOMContentLoaded", function () {
		// ✅ UTM mapping
		document.getElementById("00NWJ000005RA5F").value = getQueryParam("utm_source");   // Source
		document.getElementById("00NWJ000005RAOb").value = getQueryParam("utm_medium");   // Medium
		document.getElementById("00NWJ000005RAtF").value = getQueryParam("utm_term");     // Term
		document.getElementById("00NWJ000005RBHR").value = getQueryParam("utm_content");  // Content
		document.getElementById("00NWJ000005RARp").value = getQueryParam("utm_campaign"); // Campaign

		// ✅ Campaign_ID dropdown selection
		let campaignParam = getQueryParam("campaign");  // reads ?campaign=...
		let selectField = document.getElementById("Campaign_ID");

		if (campaignParam && selectField) {
		  let optionToSelect = Array.from(selectField.options).find(
			opt => opt.value === campaignParam
		  );
		  if (optionToSelect) {
			optionToSelect.selected = true;
		  }
		}
	  });
	</script>
	
	<script>
		// State → City Mapping
		const cityData = {
			"KL & Selangor": ["Banting", "Kajang", "Klang Valley", "Kuala Selangor"],
			"Perak": ["Ipoh", "Sitiawan", "Taiping", "Teluk Intan"],
			"Penang": ["Penang Island", "Seberang Perai"],
			"Melaka": ["Melaka"],
			"Negeri Sembilan": ["Bahau", "Seremban"],
			"Johor": ["Batu Pahat", "Johor Bahru", "Kluang", "Kota Tinggi", "Mersing", "Muar", "Segamat"],
			"Kedah": ["Alor Setar", "Sungai Petani"],
			"Perlis": ["Kangar"],
			"Pahang": ["Bentong", "Kuantan", "Mentakab", "Raub"],
			"Kelantan": ["Kota Bahru"],
			"Terengganu": ["Kemaman", "Kuala Terengganu"],
			"Sabah": ["Kota Kinabalu", "Lahad Datu", "Labuan", "Sandakan", "Tawau"],
			"Sarawak": ["Bintulu", "Kuching", "Miri", "Sibu"]
		};

		// Function to load cities based on selected state
		function loadCities() {
			const stateValue = document.getElementById("00NWJ000005V1JV").value;
			const citySelect = document.getElementById("location");

			citySelect.innerHTML = "<option value='' disabled selected>Please select a city</option>";

			if (cityData[stateValue]) {
				cityData[stateValue].forEach(function(city) {
					citySelect.innerHTML += `<option value="${city}">${city}</option>`;
				});
			}
		}
	</script>



</body>
</html>



<script>
    /* =============================================
       CITY DATA
    ============================================= */
    const cityData = {
        "KL & Selangor": ["Banting", "Kajang", "Klang Valley", "Kuala Selangor"],
        "Perak": ["Ipoh", "Sitiawan", "Taiping", "Teluk Intan"],
        "Penang": ["Penang Island", "Seberang Perai"],
        "Melaka": ["Melaka"],
        "Negeri Sembilan": ["Bahau", "Seremban"],
        "Johor": ["Batu Pahat", "Johor Bahru", "Kluang", "Kota Tinggi", "Mersing", "Muar", "Segamat"],
        "Kedah": ["Alor Setar", "Sungai Petani"],
        "Perlis": ["Kangar"],
        "Pahang": ["Bentong", "Kuantan", "Mentakab", "Raub"],
        "Kelantan": ["Kota Bahru"],
        "Terengganu": ["Kemaman", "Kuala Terengganu"],
        "Sabah": ["Kota Kinabalu", "Lahad Datu", "Labuan", "Sandakan", "Tawau"],
        "Sarawak": ["Bintulu", "Kuching", "Miri", "Sibu"]
    };

    /* =============================================
       STEP 1: After plugin runs, snapshot State 
       dropdown's generated HTML as our template
    ============================================= */
    var pluginStructure = null;

    $(document).ready(function() {
        // Give the plugin time to fully initialize
        setTimeout(function() {
            snapshotPluginStructure();
        }, 800);
    });

    function snapshotPluginStructure() {
        // Use the STATE dropdown (which works) as our reference
        var $stateSelect  = $("#00NWJ000005V1JV");
        var $stateWrapper = $stateSelect.closest(".custom-dropdown-select");

        // Find what the plugin generated — everything that is NOT the native select or label
        var $inner = $stateWrapper.find(".custom-dropdown-select__inner, > div").first();

        // Find the plugin-generated list/dropdown container
        // Try common patterns the plugin may use
        var $list = $inner.find("ul, ol, [class*='list'], [class*='menu'], [class*='options'], [class*='dropdown']").first();
        var $item = $list.find("li, [class*='item'], [class*='option']").first();
        var $display = $inner.find("button, input, [class*='title'], [class*='value'], [class*='display'], [class*='current']").first();

        pluginStructure = {
            listTag:        $list.prop("tagName")        || "ul",
            listClass:      $list.attr("class")          || "",
            itemTag:        $item.prop("tagName")        || "li",
            itemClass:      $item.attr("class")          || "",
            displayTag:     $display.prop("tagName")     || "button",
            displayClass:   $display.attr("class")       || "",
            listSelector:   $list.prop("tagName")        ? $list.prop("tagName").toLowerCase() : null,
            displayEl:      $display
        };

        console.log("[loadCities] Plugin structure detected:", pluginStructure);
    }

    /* =============================================
       STEP 2: loadCities — update native select
       + rebuild plugin UI using detected structure
    ============================================= */
    function loadCities() {
        var stateValue  = document.getElementById("00NWJ000005V1JV").value;
        var $citySelect = $("#location");
        var $cityWrapper = $citySelect.closest(".custom-dropdown-select");
        var $cityInner  = $cityWrapper.find(".custom-dropdown-select__inner, > div").first();

        /* --- A. Update native <select> (needed for form submission) --- */
        $citySelect.empty().append(
            '<option value="" disabled selected data-hidden="true">Please select a city</option>'
        );
        if (cityData[stateValue]) {
            cityData[stateValue].forEach(function(city) {
                $citySelect.append('<option value="' + city + '">' + city + '</option>');
            });
        }

        /* --- B. Ensure structure is snapshotted --- */
        if (!pluginStructure) {
            snapshotPluginStructure();
        }

        /* --- C. If structure was detected, rebuild plugin UI directly --- */
        if (pluginStructure && pluginStructure.listSelector) {
            rebuildPluginUI($citySelect, $cityInner, stateValue);
        } else {
            /* --- D. Fallback: Replace the entire wrapper and let plugin re-scan --- */
            fallbackReinit($cityWrapper, $citySelect, stateValue);
        }
    }

    /* =============================================
       Rebuild the plugin's custom UI directly
       using the snapshotted structure
    ============================================= */
    function rebuildPluginUI($citySelect, $cityInner, stateValue) {
        var listTag  = pluginStructure.listTag.toLowerCase();
        var listClass = pluginStructure.listClass;
        var itemTag  = pluginStructure.itemTag.toLowerCase();
        var itemClass = pluginStructure.itemClass.replace(/\bselected\b|\bactive\b|\bhighlighted\b/g, "").trim();

        // Find and clear the plugin's list
        var $existingList = $cityInner.find(listTag + ", [class*='list'], [class*='menu']").first();

        if (!$existingList.length) {
            // List not found — create it
            $existingList = $('<' + listTag + ' class="' + listClass + '"></' + listTag + '>');
            $cityInner.append($existingList);
        } else {
            $existingList.empty();
        }

        // Add placeholder item
        $existingList.append(
            '<' + itemTag + ' class="' + itemClass + ' disabled" data-value="">' +
            'Please select a city' +
            '</' + itemTag + '>'
        );

        // Add city items
        if (cityData[stateValue]) {
            cityData[stateValue].forEach(function(city) {
                $existingList.append(
                    '<' + itemTag + ' class="' + itemClass + '" data-value="' + city + '">' +
                    city +
                    '</' + itemTag + '>'
                );
            });
        }

        // Reset the display text to placeholder
        var $display = $cityInner.find(
            "button, input[type='text'], [class*='title'], [class*='value'], [class*='display'], [class*='current']"
        ).first();
        if ($display.is("input")) {
            $display.val("Please select a city");
        } else {
            $display.text("Please select a city");
        }

        // Re-bind click events so selecting a city actually works
        $existingList.find(itemTag).on("click", function() {
            var val  = $(this).data("value");
            var text = $(this).text();

            if (!val) return;

            // Update native select value
            $citySelect.val(val).trigger("change");

            // Update display
            if ($display.is("input")) {
                $display.val(text);
            } else {
                // Bootstrap-style: update inner span if present
                $display.find("[class*='inner'], [class*='text'], span").first().text(text);
                if (!$display.find("span").length) $display.text(text);
            }

            // Highlight selected item
            $(this).siblings().removeClass("selected active");
            $(this).addClass("selected active");

            // Close the dropdown (trigger click outside)
            $("body").trigger("click");
        });

        console.log("[loadCities] Plugin UI rebuilt for:", stateValue);
    }

    /* =============================================
       Fallback: Full replace + re-trigger plugin
    ============================================= */
    function fallbackReinit($cityWrapper, $citySelect, stateValue) {
        console.warn("[loadCities] Using fallback reinit");

        // Rebuild original clean HTML
        var optionsHTML = '<option value="" disabled selected data-hidden="true">Please select a city</option>';
        if (cityData[stateValue]) {
            cityData[stateValue].forEach(function(city) {
                optionsHTML += '<option value="' + city + '">' + city + '</option>';
            });
        }

        $cityWrapper.replaceWith(
            '<div class="custom-dropdown-select">' +
                '<div class="custom-dropdown-select__inner">' +
                    '<label class="sr-only" for="location">City</label>' +
                    '<select class="w-100" data-select-dropdown data-style data-live-search="true"' +
                        ' aria-expanded="true" id="location" name="00NWJ000005H5oP" title="City">' +
                        optionsHTML +
                    '</select>' +
                '</div>' +
            '</div>'
        );

        // Re-trigger plugin scanning
        var $newSelect = $("#location");
        $newSelect.trigger("init");
        $newSelect.trigger("reinit");
        $(document).trigger("init.dropdown", [$newSelect]);
        if (typeof $newSelect.selectpicker === "function") $newSelect.selectpicker("refresh");
    }
</script>

