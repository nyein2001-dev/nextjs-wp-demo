// Wait for DOM to be fully loaded
document.addEventListener("DOMContentLoaded", () => {
  // Get references to the dropdowns
  const serviceSelect = document.getElementById("selectTopic")
  const solutionDropdownContainer = document.getElementById("selectTopic2").closest(".input-text-field")

  // Initially hide the solution dropdown
  if (solutionDropdownContainer) {
    solutionDropdownContainer.style.display = "none"
  }

  // Add event listener to service dropdown
  if (serviceSelect) {
    serviceSelect.addEventListener("change", function () {
      const selectedValue = this.value

      // Check if "Service 2" is selected (value contains "Service 2")
      if (selectedValue.includes("Service 2")) {
        // Show the solution dropdown
        if (solutionDropdownContainer) {
          solutionDropdownContainer.style.display = "block"
        }
      } else {
        // Hide the solution dropdown for any other selection
        if (solutionDropdownContainer) {
          solutionDropdownContainer.style.display = "none"

          // Reset the solution dropdown selection
          const solutionSelect = document.getElementById("selectTopic2")
          if (solutionSelect) {
            solutionSelect.selectedIndex = 0 // Reset to first option (placeholder)

            // Update Bootstrap Select display if it exists
            const bootstrapButton = solutionSelect.parentElement.querySelector(".dropdown-toggle")
            if (bootstrapButton) {
              const filterOption = bootstrapButton.querySelector(".filter-option-inner-inner")
              if (filterOption) {
                filterOption.textContent = "Please select solution"
              }
              bootstrapButton.classList.add("bs-placeholder")
              bootstrapButton.title = "Please select solution"
            }
          }
        }
      }
    })
  }

  // Handle Bootstrap Select change events (if using Bootstrap Select)
  const serviceBootstrapSelect = serviceSelect?.parentElement
  if (serviceBootstrapSelect && serviceBootstrapSelect.classList.contains("bootstrap-select")) {
    // Listen for Bootstrap Select change events
    const dropdownItems = serviceBootstrapSelect.querySelectorAll(".dropdown-item")
    dropdownItems.forEach((item) => {
      item.addEventListener("click", () => {
        // Small delay to ensure the select value is updated
        setTimeout(() => {
          const event = new Event("change")
          serviceSelect.dispatchEvent(event)
        }, 10)
      })
    })
  }
})

// Alternative approach using MutationObserver for dynamic content
function initDropdownController() {
  const serviceSelect = document.getElementById("selectTopic")
  const solutionDropdownContainer = document.getElementById("selectTopic2")?.closest(".input-text-field")

  if (!serviceSelect || !solutionDropdownContainer) {
    // If elements are not ready, try again after a short delay
    setTimeout(initDropdownController, 100)
    return
  }

  // Initially hide the solution dropdown
  solutionDropdownContainer.style.display = "none"

  // Function to handle visibility logic
  function handleServiceChange() {
    const selectedValue = serviceSelect.value

    if (selectedValue.includes("Service 2")) {
      solutionDropdownContainer.style.display = "block"
    } else {
      solutionDropdownContainer.style.display = "none"

      // Reset solution dropdown
      const solutionSelect = document.getElementById("selectTopic2")
      if (solutionSelect) {
        solutionSelect.selectedIndex = 0

        // Update Bootstrap Select UI
        const bootstrapButton = solutionSelect.parentElement?.querySelector(".dropdown-toggle")
        if (bootstrapButton) {
          const filterOption = bootstrapButton.querySelector(".filter-option-inner-inner")
          if (filterOption) {
            filterOption.textContent = "Please select solution"
          }
          bootstrapButton.classList.add("bs-placeholder")
          bootstrapButton.title = "Please select solution"
        }
      }
    }
  }

  // Add event listeners
  serviceSelect.addEventListener("change", handleServiceChange)

  // Handle Bootstrap Select clicks
  const serviceDropdownItems = serviceSelect.parentElement?.querySelectorAll(".dropdown-item")
  if (serviceDropdownItems) {
    serviceDropdownItems.forEach((item) => {
      item.addEventListener("click", () => {
        setTimeout(handleServiceChange, 50)
      })
    })
  }
}

// Initialize when DOM is ready
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", initDropdownController)
} else {
  initDropdownController()
}
