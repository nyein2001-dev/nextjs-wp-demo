 out.print(responeObjectWithData(200, "send email and api call success.", referralId, referralAgent));   

public String responeObjectWithData(int statusCode, String message, String referralId, String referralAgent) {
        StringBuilder sb = new StringBuilder();
        sb.append("{");
        sb.append("\"statusCode\":").append(statusCode).append(",");
        sb.append("\"message\":\"").append(message).append("\",");
        sb.append("\"referralId\":\"").append(referralId != null ? referralId : "").append("\",");
        sb.append("\"referralAgent\":\"").append(referralAgent != null ? referralAgent : "").append("\"");
        sb.append("}");
        return sb.toString();
    }


setTimeout(function () {
    let finalUrl = redirect_url_link; // base redirect link

    // Extract values from API response
    let referralId = t.referralId || "";
    let referralAgent = t.referralAgent || "";

    // Build query parameters
    if (referralId) {
        let params = "uniqueId=" + encodeURIComponent(referralId);
        if (referralAgent) {
            params += "&agentCode=" + encodeURIComponent(referralAgent);
        }
        params += "&source=corpweb";

        finalUrl += (finalUrl.includes("?") ? "&" : "?") + params;
    }

    // Redirect
    window.location.href = finalUrl;
}, 300);


// Store referral data in sessionStorage
if (t.referralId) {
    sessionStorage.setItem("referralId", t.referralId);
    sessionStorage.setItem("referralAgent", t.referralAgent || "");
}


let referralId = sessionStorage.getItem("referralId") || "";
let referralAgent = sessionStorage.getItem("referralAgent") || "";

let finalUrl = redirect_url_link;

if (referralId) {
    let params = "uniqueId=" + encodeURIComponent(referralId);
    if (referralAgent) {
        params += "&agentCode=" + encodeURIComponent(referralAgent);
    }
    params += "&source=corpweb";

    finalUrl += (finalUrl.includes("?") ? "&" : "?") + params;
}

window.location.href = finalUrl;


----------------------------------------------------------------------------

// Save only if referralId is provided
if (t.referralId) {
    localStorage.setItem("referralId", t.referralId);
    localStorage.setItem("referralAgent", t.referralAgent || "");
}


let referralId = localStorage.getItem("referralId") || "";
let referralAgent = localStorage.getItem("referralAgent") || "";

let finalUrl = redirect_url_link;

if (referralId) {
    let params = "uniqueId=" + encodeURIComponent(referralId);
    if (referralAgent) {
        params += "&agentCode=" + encodeURIComponent(referralAgent);
    }
    params += "&source=corpweb";

    finalUrl += (finalUrl.includes("?") ? "&" : "?") + params;
}

// Redirect
window.location.href = finalUrl;

